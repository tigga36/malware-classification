#「download.cnet.com」のソフトウェア毎のURL取得用

import chromedriver_binary
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.common.keys import Keys
import time
import traceback

options = webdriver.ChromeOptions()
options.add_argument('--headless')
options.add_argument('--disable-gpu')
driver = webdriver.Chrome(options=options)

path = 'url.txt'
with open(path, 'r', encoding='utf-8') as f:
    apps = f.readlines()

driver.get('https://download.cnet.com/windows/')
#WebDriverWait(driver, 15).until(EC.presence_of_all_elements_located)
time.sleep(5)
driver.find_element(By.XPATH, '//*[@id="rb_skin"]/div[2]/div/a/span').click()
time.sleep(3)

LIMIT = 30000
try:
    n1 = 0
    app_elements = driver.find_elements(By.XPATH, '//*[@id="product-container"]/a')
    n2 = len(app_elements)
    for app in app_elements[n1:n2]:
        app_url = app.get_attribute("href")
        apps.append(app_url + '\n')
    apps = list(dict.fromkeys(apps))
    while n1 < n2 and len(apps) <= LIMIT:
        actions = ActionChains(driver)
        actions.move_to_element(app_elements[-1])
        actions.perform()
        time.sleep(3)
        app_elements = driver.find_elements(By.XPATH, '//*[@id="product-container"]/a')
        n1 = n2
        n2 = len(app_elements)
        for app in app_elements[n1:n2]:
            app_url = app.get_attribute("href")
            apps.append(app_url + '\n')
        apps = list(dict.fromkeys(apps))

    path = 'url.txt'
    with open(path, 'w', encoding='utf-8') as f:
        f.writelines(apps)
    driver.quit()

except:
    driver.quit()
