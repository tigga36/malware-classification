#strings抽出用モジュール

# Copyright (C) 2012-2013 Claudio Guarnieri.
# Copyright (C) 2014-2017 Cuckoo Foundation.
# This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org
# See the file 'docs/LICENSE' for copying permission.

import os.path
import re

#from cuckoo.common.abstracts import Processing
#from cuckoo.common.exceptions import CuckooProcessingError

#class Strings(Processing):
#    """Extract strings from analyzed file."""

MAX_FILESIZE = 16*1024*1024
MAX_STRINGCNT = 2048
MAX_STRINGLEN = 1024

def run(file_path):
    """Run extract of printable strings.
    @return: list of printable strings.
    """
    key = "strings"
    strings = []

    if not os.path.exists(file_path):
        #raise CuckooProcessingError(
        print("Sample file doesn't exist: \"%s\"" % file_path)
        #)
        return

    try:
        data = open(file_path, "rb").read(MAX_FILESIZE)
    except (IOError, OSError) as e:
        pass

    strings = []
    for s in re.findall(b"[\x1f-\x7e]{6,}", data):
        strings.append(s.decode("utf-8"))
    for s in re.findall(b"(?:[\x1f-\x7e][\x00]){6,}", data):
        strings.append(s.decode("utf-16le"))

    # Now limit the amount & length of the strings.
    strings = strings[:MAX_STRINGCNT]
    for idx, s in enumerate(strings):
        strings[idx] = s[:MAX_STRINGLEN]

    return strings

if __name__ == '__main__':
    file_path = ''
    strings = run(file_path)
    print(strings)